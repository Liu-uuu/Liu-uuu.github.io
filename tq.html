<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="key">
	<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">
	<link rel="shortcut icon"  href="myicon.png">
	<title>天气-JXXL</title>
	
	<script>
		var thisHtml=document.getElementsByTagName('html');
		var deviceW=document.documentElement.clientWidth;
		thisHtml[0].style.fontSize=deviceW/3.75+"px";
	</script>
	<style type="text/css">

/*		html,body{
			height: 100%;
		}*/
		body,ul,li,h3,h4,p{
			margin: 0;
			padding: 0;
			font-size: 0.16rem;
		}
		body{
			padding-bottom:0.5rem;
			background:#f0f0f0;
			font-size:"微软雅黑";
		}
		ul{
			list-style: none;
		}
	
		#top{
			width:100%; background: #0D5AA5;
			font-size: 0.18rem; line-height: 0.4rem; text-align: center; color: #fff;
			position:fixed;
			z-index:10;
		}
		/*更多*/
		#more{
			position:absolute;left:4px;
		}
		/*css3图标*/
		#top .css3-icon{
			display:inline-block;
			width:0.15rem; height:0.03rem; background:#fff; padding:0.02rem 0; margin-right:4px;
			border-top:0.03rem solid #fff; border-bottom:0.03rem solid #fff;
			background-clip:content-box;	
		}

		/*城市列表*/
		#citylist{
			position:absolute;
			display:none;
		}
		#citylist ul{
			background:#eee; width:1.2rem; padding:0 0.15rem 0.15rem;
			font-size:0; color:#333;
		}
		#citylist li{
			padding:0 0.2em; border-bottom:1px solid #333;
			font-size:0.2rem; line-height:2; text-align:left;
		}
		#citylist .right{
			float:right;
		}
		#citylist .others{
			border:0;
			font-size:0.16rem;
		}
		#citylist input{
			width:1rem; background:#fff; margin:0.02rem 0; border:1px solid #001ba0; border-radius:0.01rem;
			font-size:0.18rem; color:#001ba0;
		}
		#citylist .txt{
			text-indent:0.02rem;
		}

		/*天气*/
		#weather{
			padding-top:0.36rem;
		}

		/*各个板块的盒模型*/
		.sec-box{
			margin-bottom:0.06rem;
		}

		.sec-box h3{
			padding:0 0 0 0.08rem; background:#fff;
			border-left:4px solid #79bbdd;
			border-bottom:1px solid #ccc;
			font-size:0.18rem;line-height:0.36rem; color:#565656;
		}

		/*更新时间*/
		#updateTime{
			font-size:0.12rem;
			position:absolute;right:0.1rem;
		}

		/*实况天气*/
		#sktq{
			padding:0.3rem 0.4rem; background:url('./tqimg.jpg') no-repeat; background-size:100% 100%;
			font-family:"微软雅黑"; color:#fff;
		}
		#sktq .tmp{
			font-size:0.56rem;
		}
		#sktq .condTxt{
			font-size:0.2rem;padding-right:0.2rem;
		}
		#sktq span{
			font-size:0.16rem;
		}

		/*3小时预报*/
		#hourly{
			margin:0.04rem 0.1rem; background:#fff;  border-radius:0.06rem;
			box-shadow:1px 1px 6px #ccc;
		}
		#hourly span{
			display:inline-block;
			min-width:23%;
			text-align:center;
		}
		#hourly .wind{
			width:31%; 
		}
		#hourly h4,#hourly p{
			padding:0.06rem 0; border-bottom:1px solid #f0f0f0;
		}

		/*生活指数*/
		#shzs ul{
			margin:0.04rem 0.1rem;
			font-size:0; color:#fff;
		}
		#shzs li{
			display:inline-block; vertical-align:top;
			width:33.33%;
		}
		#shzs div{
			background:#00BCD4; padding:0.08rem; margin:0.02rem; border-radius:0.2rem;
			box-shadow:1px 1px 6px #ccc;
		}
		#shzs h4{
			text-align:center;
		}
		#shzs p{
			height:0.56rem;
			overflow:auto;
		}

		/*7天预报*/
		#daily{
			margin:0.04rem 0.1rem; background:#fff;  border-radius:0.06rem;
			box-shadow:1px 1px 6px #ccc;
		}
		#daily li{
			padding:0.08rem; border-bottom:1px solid #f0f0f0;
			text-align:center;
		}
		#daily span{
			display:inline-block;
			min-width:22%;
			vertical-align:middle;
		}
		#daily .wind{
			width:31%; 
		}
	
		/*底部*/
		#footer{
			width:100%; background:#fefefe;
			box-shadow:0 -1px 6px #ccc; font-size:0;
			position:fixed; bottom:0; left:0;
		}
		#footer span{
			display:inline-block;
			width:25%;
			text-align:center;
		}
		#footer a{
			display:block;
			border-right:1px solid #eee;
			font-size:0.16rem; font-weight:normal; line-height:0.4rem; text-decoration:none; color:#000;
		}
	</style>
</head>

<body>

	<div id="top">
	 	<div id="more"><span class="css3-icon"></span><span>更多城市</span></div>
		<span id="city">当前天气：北京市</span>
		<div id="citylist">
			<ul>
				<li name="北京">北京<span class="right">&gt</span></li>
				<li name="上海">上海<span class="right">&gt</span></li>
				<li name="杭州">杭州<span class="right">&gt</span></li>
				<li name="南京">南京<span class="right">&gt</span></li>
				<li name="郑州">郑州<span class="right">&gt</span></li>
				<li class="others">
					<div>其他城市:<input type="text" class="txt"></div>
					<input type="button" value="确定">
				</li>
			</ul>
		</div>
	</div>

	<!-- 天气信息 -->
	<div id="weather">

		
		<!-- 实况天气 -->
		<div class="sec-box">
			<h3>实况天气<span id="updateTime">数据更新于:0000-00-00 00:00</span></h3>
			<div id="sktq">
				<p><span class="tmp">-℃|</span><span class="condTxt">天气</span></p>
				<p>
					<span class="displayblock">
						<span>相对湿度|</span><span>pm2.5|</span><span>空气质量</span></span>
					</span>
					<span class="displayblock">
						<span>风向|</span><span>风力</span>
					</span>
				</p>
			</div>
		</div>

		<!-- 空气质量 -->
		<div class="sec-box">
			<h3>3小时预报</h3>
			<div id="hourly">
				<h4><span>时间</span><span>温度</span><span>降水概率</span><span>风</span></h4>
				<div>
					<p><span>无数据</span><span>--</span><span>--</span><span>--</span></p>
				</div>
			</div>
		</div>

		<!-- 生活指数 -->
		<div id="shzs" class="sec-box"">
			<h3>生活指数</h3>
			<ul>
				<li style="display: none;"></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
			</ul>
		</div>
		<div class="sec-box">
			<h3>7天预报</h3>
			<ul id="daily">
				<li>
					<h4><span>时间</span><span>天气</span><span>温度</span><span>风</span></h4>	
				</li>
				<li>
					<p><span>--</span><span>--</span><span>--</span><span>--</span></p>
				</li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
			</ul>
		</div>


	</div>


	<div id="footer">
		<span><a href="./m.html">首页</a></span>
		<span><a href="./tq.html">天气</a></span>
		<span><a href="./news.html">新闻</a></span>
		<span><a href="./2048.html">小游戏</a></span>
	</div>





	<script type="text/javascript">
		var data='';
		function requestData(fn,city){
			var xhr=new XMLHttpRequest();
			xhr.open('get','https://apis.baidu.com/heweather/weather/free?city='+city,true);
			xhr.setRequestHeader('apikey','770651441b1a9c317ead81b8a9137436');
			xhr.send();
			xhr.onreadystatechange=function(){
				if (xhr.readyState==4) {
					if (xhr.status==200) {
						data=JSON.parse(xhr.responseText)["HeWeather data service 3.0"][0];
						fn();
					}
				}
			}
		}
				
		var city=document.getElementById('city');
		var updateTime=document.getElementById('updateTime');
		var shzs=document.getElementById('shzs');

		function render(){
			if (data.status=="ok") {
				//basic基本信息
				city.innerHTML="当前天气:"+data.basic.city;
				updateTime.innerHTML="数据更新于:"+data.basic.update.loc;

				//"实况天气"
				var sktqBox=document.getElementById('sktq');
				// if (data.aqi.city.qlty) {
					var air=data.aqi?data.aqi.city.qlty:("--")
				// }else{
				// 	var air="--";
				// }
				sktqBox.innerHTML=
				"<p><span class='tmp'>"+data.now.tmp+"℃</span><span class='condTxt'>"+data.now.cond.txt+"</span></p>"+
				"<p><span  class='hum'>湿度"+data.now.hum+"%|</span><span class='qlty'>空气:"+air+"</span></p>"+
				"<p><span class='dir'>"+data.now.wind.dir+"</span><span class='sc'>"+data.now.wind.sc+"级</span></p>";
			
			
				//"3小时预报"
				var hourlyBox=document.getElementById('hourly');
				var hourlyDate="";
				for (var i = 0; i < data.hourly_forecast.length; i++) {
					hourlyDate+="<p><span>"+data.hourly_forecast[i].date.match(/\d{2}:\d{2}/)[0]+"</span><span>"+data.hourly_forecast[i].tmp+"℃</span><span>"+data.hourly_forecast[i].pop+"%</span><span class='wind'>"+data.hourly_forecast[i].wind.dir+data.hourly_forecast[i].wind.sc+"级</span></p>";
				}
				if (hourlyDate) {
					hourlyBox.innerHTML=
					"<h4><span>时间</span><span>温度</span><span>降水概率</span><span class='wind'>风</span></h4>"+
					"<div>"+hourlyDate+"</div>";
				}
				
				
				//生活指数
				var ii=0;
				var attr2=attr
				for(var attr in data.suggestion){
					
					switch(attr){
						case "comf":
							attr2="舒适度指数"
							break;
						case "cw":
							attr2="洗车指数"
							break;
						case "drsg":
							attr2="穿衣指数"
							break;
						case "flu":
							attr2="感冒指数"
							break;
						case "sport":
							attr2="运动指数"
							break;
						case "trav":
							attr2="旅游指数"
							break;
						case "uv":
							attr2="紫外线指数"
							break;
						default:
							console.log("有新数据");
					}
					shzs.getElementsByTagName('li')[ii].innerHTML="<div><h4>"+attr2+"</h4><p>"+data.suggestion[attr].brf+":"+data.suggestion[attr].txt+"</p></div>";
					ii++;
				}

				//"7天预报"
				var dailyBox=document.getElementById('daily');
				var dailyDate="";
				for (var i = 0; i < data.daily_forecast.length; i++) {
					dailyDate+="<li><span>"+data.daily_forecast[i].date+"</span><span>"+data.daily_forecast[i].cond.txt_d+"</span><span>"+data.daily_forecast[i].tmp.min+"-"+data.daily_forecast[i].tmp.max+"℃</span><span class='wind'>"+data.daily_forecast[i].wind.dir+"<br/>"+data.daily_forecast[i].wind.sc+"级</span></li>";
				}
				if (dailyDate) {
					dailyBox.innerHTML=
					"<li><h4><span>时间</span><span>天气</span><span>温度</span><span class='wind'>风</span></h4></li>"+dailyDate;
				}
			}else{
				alert(data.status+'：没有找到这个城市的天气。注意所输入城市名不能带有"市"或"县"字"，如果输入没错，那就是服务器挂了！')
			}
		}

		requestData(render,"北京");

		var more=document.getElementById('more');
		var citylist=document.getElementById('citylist');
		more.addEventListener("touchend",function(){
			if (citylist.onoff) {
				citylist.style.display="none";
				citylist.onoff=false;
				this.innerHTML="<span class='css3-icon'></span><span>更多城市</span>"
			}else{
				citylist.style.display="block";
				citylist.onoff=true;
				this.innerHTML="<span class='css3-icon'></span><span>收起↑</span>"
			}
			
		}) 
		citylist.addEventListener("touchend",function(ev){
			if (ev.target.nodeName.toLowerCase()=="li") {
				requestData(render,ev.target.getAttribute("name"));
				citylist.style.display="none";
				citylist.onoff=false;
				more.innerHTML="<span class='css3-icon'></span><span>更多城市</span>"
			}
		})
		var ipts=citylist.getElementsByTagName("input");
		ipts[1].addEventListener("touchend",function(){
			if (ipts[0].value) {
				requestData(render,ipts[0].value);
				citylist.style.display="none";
				citylist.onoff=false;
				more.innerHTML="<span class='css3-icon'></span><span>更多城市</span>"
			}else{
				alert('请输入一个城市名吧')
			}
		})
		
	
	  
	</script>

</body>
</html>